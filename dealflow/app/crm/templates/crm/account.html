{% extends "./base/base.html" %}


{% block side_bar %}
    {% include "./base/side_bar.html" %}
{% endblock %}

{% block header %}
    {% include "./base/header.html" %}
{% endblock %}


{% block content %}


<div class="wrapper">
    <h1><i class="bi bi-building"></i> Gestion des Comptes Clients</h1>

    <div class="kpi-grid">
        
        <div class="kpi-card">
            <p class="kpi-title">Valeur Totale du Pipeline</p>
            <p class="kpi-value">225 000 €</p>
            <p class="kpi-trend"><i class="bi bi-graph-up"></i> +15% vs Mois Dernier</p>
        </div>
        
        <div class="kpi-card">
            <p class="kpi-title">Compte Total</p>
            <p class="kpi-value">12</p>
            <p class="kpi-trend"><i class="bi bi-check2-circle"></i> Objectif atteint à 80%</p>
        </div>
        
        <div class="kpi-card risk">
            <p class="kpi-title">Comptes Sans Activité</p>
            <p class="kpi-value">7</p>
            <p class="kpi-trend"><i class="bi bi-exclamation-triangle-fill"></i> N'ont pas été contactés depuis 30 jours</p>
        </div>
        
    </div>
    
    <header class="list-header-actions">
        
        <div class="search-controls">
            <input type="text" class="search-input" placeholder="Rechercher par Nom d'Entreprise...">
        </div>

        <div class="actions">
            <a href="{% url 'account_create' %}" class="btn btn-primary new-account-btn">
                <i class="bi bi-building-add"></i> Nouveau Compte
            </a>
        </div>
    </header>

    {% if accounts %}

    {% for account in accounts %}

    <div class="table-container">
        <table class="accounts-table">
            <thead>
                <tr>
                    <th>Nom de l'Entreprise</th>
                    <th>Ville</th>
                    <th>Contact Principal</th>
                    <th>Téléphone</th>
                    <th>Pipeline Actif</th>
                    <th>Statut</th>
                    <th>Actions</th>    
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="col-name">{{ account.account_name }}</td>
                    <td>{{ account.address }}</td>
                    <td class="col-contact">
                        {% for prospect in account.prospect.all %}
                        {{ prospect.first_name }} {{ prospect.last_name }}
                        {% empty %}
                        Null
                        {% endfor %}
                    </td>
                    <td class="col-phone">{{ account.account_phone_number }}</td>
                    <td class="col-pipeline-value">65 000 €</td>
                    <td class="col-status">
                        <span style="color: var(--bs-text-green);">
                            <i class="bi bi-arrow-up-circle-fill"></i> {{ account.status }}
                        </span>
                    </td>
                    <td class="col-actions">
                        <button class="btn action-btn edit" title="Voir Fiche"><i class="bi bi-box-arrow-in-up-right"></i></button>
                        <button class="btn action-btn" title="Ajouter Affaire"><i class="bi bi-plus-circle"></i></button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    {% endfor %}

    {% endif %}

</div>

{% endblock %}